# TXT到JSON转换工具

这是一个利用DeepSeek API将TXT文本转换为index-tts v2引擎有声书脚本管理器所需JSON格式的工具。

## 功能特点

- 自动按章节分割文本
- 按段落或字数进一步分割长文本（防止API调用时输入过多导致输出被截断）
- 批量处理文本片段并调用DeepSeek API进行转换
- 按章节组织和保存JSON结果


## 安装依赖

在运行程序之前，需要先创建一个虚拟环境，然后用虚拟环境安装必要的Python依赖包：

```bash
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
```

## 使用方法

1. 确保您已经获得了DeepSeek API的密钥。如果没有，可以访问[DeepSeek官网](https://www.deepseek.com/)申请。

2. 准备好要转换的TXT文件。

3. 运行程序：

```bash
python run_webui.py
```

4. 根据提示输入以下信息：
   - DeepSeek API密钥
   - 并行请求数（deepseek不限制api并发数，调大处理速度会比较快，注意token消耗。）


##文档预处理

在使用前，需要对文档进行预处理，包括：
1. 检查文档是否为txt格式
2. 检查文档是否为utf-8编码
3. 建议在每个章节前面添加”#“号，否则整个文档会被识别为一整个章节。

## 输出结果

程序会生成以下输出：
在脚本根目录workshop文件夹中会有一个文本同名的项目文件夹，可以直接用有声书脚本管理器打开。


## 注意事项

1. API调用可能会产生费用，请确保您了解DeepSeek的计费规则。
2. 程序包含简单的错误处理和重试机制，但在网络不稳定的情况下仍可能出现问题。
3. 章节识别基于正则表达式，可能无法识别所有特殊格式的章节标题。
4. 转换结果的质量取决于输入文本的清晰度和LLM的理解能力。

## 示例

假设您有一个名为"novel.txt"的文件，包含以下内容：

```
第一章 开始
这是第一章的内容...
第二章 发展
这是第二章的内容...
```

运行程序后，将会生成一个完整的JSON文件和两个章节JSON文件。

## 关于情感向量

根据prompt的要求，生成的JSON中包含情感向量(emo_vector)，用于控制语音合成的情感表达。情感向量包含8个浮点数，分别代表：喜、怒、哀、惧、厌恶、低落、惊喜、平静。

如有任何问题或建议，请随时提出。